
<!DOCTYPE html>

<html data-content_root="../" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Using callbacks with hydra-zen." name="description"/>
<link href="../_static/hydra_zen_favicon_64x64.ico" rel="icon" type="image/x-icon"/>
<link href="../_static/hydra_zen_favicon_32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="../_static/hydra_zen_favicon_64x64.png" rel="icon" sizes="64x64" type="image/png"/>
<title>Use Hydra’s Callbacks to Run Code Before and After Jobs — hydra-zen  documentation</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
<!--
    this give us a css class that will be invisible only if js is disabled
  -->
<noscript>
<style>
      .pst-js-only { display: none !important; }

    </style>
</noscript>
<!-- Loaded before other Sphinx assets -->
<link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet">
<link href="../_static/pygments.css?v=8f2a1f02" rel="stylesheet" type="text/css">
<link href="../_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-codeautolink.css?v=b2176991" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-design.min.css?v=95c83b7e" rel="stylesheet" type="text/css"/>
<!-- So that users can add custom icons -->
<script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" rel="preload"/>
<link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" rel="preload"/>
<script src="../_static/documentation_options.js?v=5929fcd5"></script>
<script src="../_static/doctools.js?v=9bcbadda"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="../_static/clipboard.min.js?v=a7894cd8"></script>
<script src="../_static/copybutton.js?v=30646c52"></script>
<script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-115029372-2"></script>
<script src="../_static/gtag.js?v=dff6cbd6"></script>
<script src="../_static/design-tabs.js?v=f930bc37"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'how_to/use_callbacks';</script>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="partial_config.html" rel="next" title="Partially Configure an Object"/>
<link href="pydantic_guide.html" rel="prev" title="Add Pydantic Type Checking and Parsing to Your Hydra App"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
<meta content="" name="docsearch:version"/>
</link></link></link></head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="" data-offset="180">
<div class="skip-link d-print-none" id="pst-skip-link"><a href="#main-content">Skip to main content</a></div>
<div id="pst-scroll-pixel-helper"></div>
<button class="btn rounded-pill" id="pst-back-to-top" type="button">
<i class="fa-solid fa-arrow-up"></i>Back to top</button>
<dialog id="pst-search-dialog">
<form action="../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search the docs ..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" name="q" placeholder="Search the docs ..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
</dialog>
<div class="pst-async-banner-revealer d-none">
<aside aria-label="Version warning" class="d-none d-print-none" id="bd-header-version-warning"></aside>
</div>
<header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
<button aria-label="Site navigation" class="pst-navbar-icon sidebar-toggle primary-toggle">
<span class="fa-solid fa-bars"></span>
</button>
<div class="col-lg-3 navbar-header-items__start">
<div class="navbar-item">
<a class="navbar-brand logo" href="../index.html">
<img alt="hydra-zen  documentation - Home" class="logo__image only-light" src="../_static/Hydra-Zen_logo_full_light_blue.png"/>
<img alt="hydra-zen  documentation - Home" class="logo__image only-dark pst-js-only" src="../_static/Hydra-Zen_logo_full_light_blue.png"/>
</a></div>
</div>
<div class="col-lg-9 navbar-header-items">
<div class="me-auto navbar-header-items__center">
<div class="navbar-item">
<nav>
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="../how_tos.html">
    How-To Guides
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../explanation.html">
    Explanation
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../api_reference.html">
    Reference
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../changes.html">
    Changelog
  </a>
</li>
</ul>
</nav></div>
</div>
<div class="navbar-header-items__end">
<div class="navbar-item navbar-persistent--container">
<button aria-label="Search" class="btn search-button-field search-button__button pst-js-only" data-bs-placement="bottom" data-bs-toggle="tooltip" title="Search">
<i class="fa-solid fa-magnifying-glass"></i>
<span class="search-button__default-text">Search</span>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
</div>
<div class="navbar-item">
<button aria-label="Color mode" class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" data-bs-placement="bottom" data-bs-title="Color mode" data-bs-toggle="tooltip">
<i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light" title="Light"></i>
<i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark" title="Dark"></i>
<i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto" title="System Settings"></i>
</button></div>
<div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links">
<li class="nav-item">
<a class="nav-link pst-navbar-icon" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/mit-ll-responsible-ai/hydra-zen" rel="noopener" target="_blank" title="GitHub"><i aria-hidden="true" class="fab fa-github-square fa-lg"></i>
<span class="sr-only">GitHub</span></a>
</li>
</ul></div>
</div>
</div>
<div class="navbar-persistent--mobile">
<button aria-label="Search" class="btn search-button-field search-button__button pst-js-only" data-bs-placement="bottom" data-bs-toggle="tooltip" title="Search">
<i class="fa-solid fa-magnifying-glass"></i>
<span class="search-button__default-text">Search</span>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
</div>
<button aria-label="On this page" class="pst-navbar-icon sidebar-toggle secondary-toggle">
<span class="fa-solid fa-outdent"></span>
</button>
</div>
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<dialog id="pst-primary-sidebar-modal"></dialog>
<div class="bd-sidebar-primary bd-sidebar" id="pst-primary-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
<div class="sidebar-header-items__center">
<div class="navbar-item">
<nav>
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="../how_tos.html">
    How-To Guides
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../explanation.html">
    Explanation
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../api_reference.html">
    Reference
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../changes.html">
    Changelog
  </a>
</li>
</ul>
</nav></div>
</div>
<div class="sidebar-header-items__end">
<div class="navbar-item">
<button aria-label="Color mode" class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" data-bs-placement="bottom" data-bs-title="Color mode" data-bs-toggle="tooltip">
<i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light" title="Light"></i>
<i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark" title="Dark"></i>
<i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto" title="System Settings"></i>
</button></div>
<div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links">
<li class="nav-item">
<a class="nav-link pst-navbar-icon" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/mit-ll-responsible-ai/hydra-zen" rel="noopener" target="_blank" title="GitHub"><i aria-hidden="true" class="fab fa-github-square fa-lg"></i>
<span class="sr-only">GitHub</span></a>
</li>
</ul></div>
</div>
</div>
<div class="sidebar-primary-items__start sidebar-primary__section">
<div class="sidebar-primary-item">
<nav aria-label="Section Navigation" class="bd-docs-nav bd-links">
<p aria-level="1" class="bd-links__title" role="heading">Section Navigation</p>
<div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="configuring_experiments.html">Configure Multiple Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_hydra.html">Customize Hydra’s Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="pydantic_guide.html">Add Pydantic Type Checking and Parsing to Your Hydra App</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Use Hydra’s Callbacks to Run Code Before and After Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="partial_config.html">Partially Configure an Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="beartype.html">Add Enhanced Runtime Type-Checking to a Hydra App</a></li>
</ul>
</div>
</nav></div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
<div class="sidebar-primary-item">
<div class="flat" data-ea-manual="true" data-ea-publisher="readthedocs" data-ea-type="readthedocs-sidebar" id="ethical-ad-placement">
</div></div>
</div>
</div>
<main class="bd-main" id="main-content" role="main">
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item">
<nav aria-label="Breadcrumb" class="d-print-none">
<ul class="bd-breadcrumbs">
<li class="breadcrumb-item breadcrumb-home">
<a aria-label="Home" class="nav-link" href="../index.html">
<i class="fa-solid fa-home"></i>
</a>
</li>
<li class="breadcrumb-item"><a class="nav-link" href="../how_tos.html">How-To Guides</a></li>
<li aria-current="page" class="breadcrumb-item active"><span class="ellipsis">Use Hydra’s Callbacks to Run Code Before and After Jobs</span></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article">
<section id="use-hydra-s-callbacks-to-run-code-before-and-after-jobs">
<span id="callbacks"></span><h1>Use Hydra’s Callbacks to Run Code Before and After Jobs<a class="headerlink" href="#use-hydra-s-callbacks-to-run-code-before-and-after-jobs" title="Link to this heading">#</a></h1>
<p>Hydra’s <a class="reference external" href="https://hydra.cc/docs/experimental/callbacks/">callback system</a> lets us run
custom code that is triggered by events, such as a job starting and a job completing.
This enables us to do things like upload a job’s results to cloud storage or
turn on performance profiling in a configurable and modular way. These callbacks can be
used across applications - independent of our task function and its config.</p>
<p>In this How-To, we will write toy versions of two such callbacks and will incorporate
them in our hydra-zen code. First, we will hardcode our application to use these
callbacks, and then we will rewrite things so that the callbacks can be enabled from the CLI.</p>
<section id="adding-basic-callback-support-to-an-application">
<h2>Adding basic callback support to an application<a class="headerlink" href="#adding-basic-callback-support-to-an-application" title="Link to this heading">#</a></h2>
<p>Here we define two callbacks - <code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeIt</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">UploadResultsCallback</span></code> <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> - and manually
add them to <a class="reference internal" href="configure_hydra.html#hydraconf"><span class="std std-ref">Hydra’s config</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Contents of <code class="xref py py-obj docutils literal notranslate"><span class="pre">my_app.py</span></code>- two callbacks are defined and added to Hydra’s config.</span><a class="headerlink" href="#id3" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/time.html#module-time" title="time"><span class="nn">time</span></a>
<span class="kn">from</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/dataclasses.html#module-dataclasses" title="dataclasses"><span class="nn">dataclasses</span></a><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/dataclasses.html#dataclasses.dataclass" title="dataclasses.dataclass"><span class="n">dataclass</span></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydra.experimental.callback</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callback</span>

<span class="c1"># The config for our task function</span>
<a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/dataclasses.html#dataclasses.dataclass" title="dataclasses.dataclass"><span class="nd">@dataclass</span></a>
<span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#int" title="int"><span class="nb">int</span></a>

<span class="c1"># Our task function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">task</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#int" title="int"><span class="nb">int</span></a><span class="p">):</span>  <span class="c1"># just an example task function - no important details</span>
   <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">".. running task(</span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s2">)"</span><span class="p">)</span>
   <span class="kn">import</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/random.html#module-random" title="random"><span class="nn">random</span></a>
   <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/time.html#time.sleep" title="time.sleep"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/random.html#random.random" title="random.random"><span class="n">random</span><span class="o">.</span><span class="n">random</span></a><span class="p">())</span>

<span class="c1"># Defining our callbacks</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeIt</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_job_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/time.html#time.time" title="time.time"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_job_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"TimeIt: Took </span><span class="si">{</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#round" title="round"><span class="nb">round</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/time.html#time.time" title="time.time"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">UploadResultsCallback</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">bucket</span><span class="p">:</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#str" title="str"><span class="nb">str</span></a> <span class="o">=</span> <span class="s2">"s3:/"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_job_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="c1"># Leverage access to the job's config to create a distinct file path.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"file_</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">.txt"</span>
        <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="sa">f</span><span class="s2">"UploadResultsCallback: Job ended, uploading results to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hydra.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">HydraConf</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hydra_zen</span><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.make_custom_builds_fn.html#hydra_zen.make_custom_builds_fn" title="hydra_zen.make_custom_builds_fn"><span class="n">make_custom_builds_fn</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.zen.html#hydra_zen.zen" title="hydra_zen.zen"><span class="n">zen</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">ZenStore</span></a>

    <span class="n">fbuilds</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.make_custom_builds_fn.html#hydra_zen.make_custom_builds_fn" title="hydra_zen.make_custom_builds_fn"><span class="n">make_custom_builds_fn</span></a><span class="p">(</span><span class="n">populate_full_signature</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">store</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">ZenStore</span></a><span class="p">()</span>
    <span class="c1"># Add our callbacks directly to Hydra's config and add it to our</span>
    <span class="c1"># config store.</span>
    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">store</span></a><span class="p">(</span>
        <span class="n">HydraConf</span><span class="p">(</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"upload"</span><span class="p">:</span> <span class="n">fbuilds</span><span class="p">(</span><span class="n">UploadResultsCallback</span><span class="p">),</span>
                <span class="s2">"timeit"</span><span class="p">:</span> <span class="n">fbuilds</span><span class="p">(</span><span class="n">TimeIt</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Add our task function's config to the store</span>
    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">store</span></a><span class="p">(</span><span class="n">Config</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"task"</span><span class="p">)</span>
    <span class="n">store</span><span class="o">.</span><span class="n">add_to_hydra_store</span><span class="p">()</span>

    <span class="c1"># Expose CLI for running `task`</span>
    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.zen.html#hydra_zen.zen" title="hydra_zen.zen"><span class="n">zen</span></a><span class="p">(</span><span class="n">task</span><span class="p">)</span><span class="o">.</span><span class="n">hydra_main</span><span class="p">(</span>
        <span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">config_name</span><span class="o">=</span><span class="s2">"task"</span><span class="p">,</span>
        <span class="n">version_base</span><span class="o">=</span><span class="s2">"1.3"</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>When we run <code class="xref py py-obj docutils literal notranslate"><span class="pre">my_app</span></code> we should see that both of our callbacks are running.
Let’s do a multirun over two values of <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Running our application using the default config.</span><a class="headerlink" href="#id4" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>my_app.py<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>,2<span class="w"> </span>-m
<span class="go">[2023-11-19 13:54:22,232][HYDRA] Launching 2 jobs locally</span>
<span class="gp">[2023-11-19 13:54:22,232][HYDRA]        #</span><span class="m">0</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>
<span class="go">.. running task(x=1)</span>
<span class="go">TimeIt: Took 0.13 seconds</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to s3://file_1.txt</span>

<span class="gp">[2023-11-19 13:54:22,481][HYDRA]        #</span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">2</span>
<span class="go">.. running task(x=2)</span>
<span class="go">TimeIt: Took 0.72 seconds</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to s3://file_2.txt</span>
</pre></div>
</div>
</div>
<p>We can override the default bucket for <code class="xref py py-obj docutils literal notranslate"><span class="pre">UploadResultsCallback</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Running with <code class="xref py py-obj docutils literal notranslate"><span class="pre">UploadResultsCallback(bucket='gcp:/')</span></code>.</span><a class="headerlink" href="#id5" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>my_app.py<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>,2<span class="w"> </span>hydra.callbacks.upload.bucket<span class="o">=</span><span class="s1">'gcp:/'</span><span class="w"> </span>-m
<span class="go">[2023-11-19 14:00:46,350][HYDRA] Launching 2 jobs locally</span>
<span class="gp">[2023-11-19 14:00:46,350][HYDRA]        #</span><span class="m">0</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>
<span class="go">.. running task(x=1)</span>
<span class="go">TimeIt: Took 0.49 seconds</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to gcp://file_1.txt</span>

<span class="gp">[2023-11-19 14:00:46,981][HYDRA]        #</span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">2</span>
<span class="go">.. running task(x=2)</span>
<span class="go">TimeIt: Took 0.9 seconds</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to gcp://file_2.txt</span>
</pre></div>
</div>
</div>
<p>We can disable the <code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeIt</span></code> callback.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Disabling <code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeIt</span></code> from the CLI.</span><a class="headerlink" href="#id6" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>my_app.py<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>,2<span class="w"> </span>~hydra.callbacks.timeit<span class="w"> </span>-m
<span class="go">[2023-11-19 14:01:42,093][HYDRA] Launching 2 jobs locally</span>
<span class="gp">[2023-11-19 14:01:42,093][HYDRA]        #</span><span class="m">0</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>
<span class="go">.. running task(x=1)</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to s3://file_1.txt</span>

<span class="gp">[2023-11-19 14:01:42,256][HYDRA]        #</span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">2</span>
<span class="go">.. running task(x=2)</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to s3://file_2.txt</span>
</pre></div>
</div>
</div>
</section>
<section id="enabling-callbacks-from-the-cli">
<h2>Enabling callbacks from the CLI<a class="headerlink" href="#enabling-callbacks-from-the-cli" title="Link to this heading">#</a></h2>
<p>Suppose that we do not want our callbacks to be enabled by default, and that we would
prefer to turn callbacks on from the CLI. To do this, we can add our callbacks to a
‘callbacks’ group in our <a class="reference internal" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.ZenStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">ZenStore</span></code></a>, and then leverage Hydra’s
<code class="xref py py-obj docutils literal notranslate"><span class="pre">group@pkg</span></code> <a class="reference external" href="https://hydra.cc/docs/advanced/override_grammar/basic/">override</a>.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Modifying <a class="reference external" href="https://docs.python.org/3/library/__main__.html#module-__main__" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__main__</span></code></a> in <code class="xref py py-obj docutils literal notranslate"><span class="pre">my_app.py</span></code></span><a class="headerlink" href="#id7" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Config, TimeIt, UploadResultsCallback, and task are unchanged</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hydra_zen</span><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.zen.html#hydra_zen.zen" title="hydra_zen.zen"><span class="n">zen</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">ZenStore</span></a>

    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">store</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">ZenStore</span></a><span class="p">()</span>

    <span class="c1"># Create configs for our callbacks and store them under the 'callbacks' group</span>
    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">store</span></a><span class="p">(</span><span class="n">UploadResultsCallback</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"upload"</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">"callbacks"</span><span class="p">)</span>
    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">store</span></a><span class="p">(</span><span class="n">TimeIt</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"timeit"</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">"callbacks"</span><span class="p">)</span>

    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.ZenStore.html#hydra_zen.ZenStore" title="hydra_zen.wrapper._implementations.ZenStore"><span class="n">store</span></a><span class="p">(</span><span class="n">Config</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"task"</span><span class="p">)</span>
    <span class="n">store</span><span class="o">.</span><span class="n">add_to_hydra_store</span><span class="p">()</span>

    <a class="sphinx-codeautolink-a" href="../generated/hydra_zen.zen.html#hydra_zen.zen" title="hydra_zen.zen"><span class="n">zen</span></a><span class="p">(</span><span class="n">task</span><span class="p">)</span><span class="o">.</span><span class="n">hydra_main</span><span class="p">(</span>
        <span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">config_name</span><span class="o">=</span><span class="s2">"task"</span><span class="p">,</span>
        <span class="n">version_base</span><span class="o">=</span><span class="s2">"1.3"</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>By default, running our app no longer includes any callbacks.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Running my_app without any callbacks.</span><a class="headerlink" href="#id8" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>my_app.py<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>,2<span class="w"> </span>-m
<span class="go">[2023-11-19 14:01:42,093][HYDRA] Launching 2 jobs locally</span>
<span class="gp">[2023-11-19 14:01:42,093][HYDRA]        #</span><span class="m">0</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>
<span class="go">.. running task(x=1)</span>

<span class="gp">[2023-11-19 14:01:42,256][HYDRA]        #</span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">2</span>
<span class="go">.. running task(x=2)</span>
</pre></div>
</div>
</div>
<p>Let’s enable both callbacks from the CLI <em>and</em> configure <code class="xref py py-obj docutils literal notranslate"><span class="pre">UploadResultsCallback(bucket='gcp:/')</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Running my_app with both callbacks enabled and <code class="xref py py-obj docutils literal notranslate"><span class="pre">UploadResultsCallback(bucket='gcp:/')</span></code>.</span><a class="headerlink" href="#id9" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>my_app.py<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span>,2<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>+callbacks@hydra.callbacks.timeit<span class="o">=</span>timeit<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>+callbacks@hydra.callbacks.upload<span class="o">=</span>upload<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>hydra.callbacks.upload.bucket<span class="o">=</span>gcp:/<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>-m
<span class="go">[2023-11-19 14:15:41,282][HYDRA] Launching 2 jobs locally</span>
<span class="gp">[2023-11-19 14:15:41,282][HYDRA]        #</span><span class="m">0</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>+callbacks@hydra.callbacks.timeit<span class="o">=</span>timeit<span class="w"> </span>+callbacks@hydra.callbacks.upload<span class="o">=</span>upload
<span class="go">.. running task(x=1)</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to gcp://file_1.txt</span>
<span class="go">TimeIt: Took 0.21 seconds</span>

<span class="gp">[2023-11-19 14:15:41,617][HYDRA]        #</span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">2</span><span class="w"> </span>+callbacks@hydra.callbacks.timeit<span class="o">=</span>timeit<span class="w"> </span>+callbacks@hydra.callbacks.upload<span class="o">=</span>upload
<span class="go">.. running task(x=2)</span>
<span class="go">UploadResultsCallback: Job ended, uploading results to gcp://file_2.txt</span>
<span class="go">TimeIt: Took 0.39 seconds</span>
</pre></div>
</div>
</div>
<p>While the input here isn’t all that concise it is nonetheless important to see that
callbacks can be enabled and configured without having to modify one’s code.</p>
</section>
<section id="footnotes">
<h2>Footnotes<a class="headerlink" href="#footnotes" title="Link to this heading">#</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a href="#id1" role="doc-backlink">1</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="https://github.com/facebookresearch/hydra/blob/809718cdcd64f9cd930d26dea69f2660a6ffa833/hydra/experimental/callback.py#L13-L65">this code</a> for the full <code class="xref py py-obj docutils literal notranslate"><span class="pre">Callback</span></code> API.</p>
</aside>
</aside>
</section>
</section>
</article>
<footer class="prev-next-footer d-print-none">
<div class="prev-next-area">
<a class="left-prev" href="pydantic_guide.html" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Add Pydantic Type Checking and Parsing to Your Hydra App</p>
</div>
</a>
<a class="right-next" href="partial_config.html" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Partially Configure an Object</p>
</div>
<i class="fa-solid fa-angle-right"></i>
</a>
</div>
</footer>
</div>
<dialog id="pst-secondary-sidebar-modal"></dialog>
<div class="bd-sidebar-secondary bd-toc" id="pst-secondary-sidebar"><div class="sidebar-secondary-items sidebar-secondary__inner">
<div class="sidebar-secondary-item">
<div class="page-toc tocsection onthispage" id="pst-page-navigation-heading-2">
<i class="fa-solid fa-list"></i> On this page
  </div>
<nav aria-labelledby="pst-page-navigation-heading-2" class="bd-toc-nav page-toc">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-basic-callback-support-to-an-application">Adding basic callback support to an application</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enabling-callbacks-from-the-cli">Enabling callbacks from the CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#footnotes">Footnotes</a></li>
</ul>
</nav></div>
<div class="sidebar-secondary-item">
<div aria-label="source link" role="note">
<h3>This Page</h3>
<ul class="this-page-menu">
<li><a href="../_sources/how_to/use_callbacks.rst.txt" rel="nofollow">Show Source</a></li>
</ul>
</div></div>
</div></div>
</div>
<footer class="bd-footer-content">
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script defer="" src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer="" src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>
<footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
<div class="footer-items__start">
<div class="footer-item">
<p class="copyright">
    
      © Copyright 2023 Massachusetts Institute of Technology.
      <br/>
</p>
</div>
<div class="footer-item">
<p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
</p>
</div>
</div>
<div class="footer-items__end">
<div class="footer-item">
<p class="theme-version">
<!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
</div>
</div>
</footer>
</body>
</html>