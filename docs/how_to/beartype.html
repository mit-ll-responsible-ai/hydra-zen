
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Enhanced Runtime Type-Checking to a Hydra App &#8212; hydra-zen 0.3.1+4.g6b39c41 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/blank.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my_theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Run Boilerplate-Free ML Experiments with PyTorch Lightning &amp; hydra-zen" href="pytorch_lightning.html" />
    <link rel="prev" title="Partially Configure an Object" href="partial_config.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="32x32" href="../_static/hydra_zen_favicon_32x32.png">
      
    
      
      <link rel="icon" sizes="64x64" href="../_static/hydra_zen_favicon_64x64.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/Hydra-Zen_logo_full_filled_bkgrnd_smaller.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../tutorials.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../how_tos.html">
  How-To Guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../explanation.html">
  Explanation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api_reference.html">
  Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../changes.html">
  Changelog
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/mit-ll-responsible-ai/hydra-zen" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p class="caption">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="partial_config.html">
   Partially Configure an Object
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Add Enhanced Runtime Type-Checking to a Hydra App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pytorch_lightning.html">
   Run Boilerplate-Free ML Experiments with PyTorch Lightning &amp; hydra-zen
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<p>Your must install <a class="reference external" href="https://github.com/beartype/beartype">beartype</a> in your Python environment in order to complete this How-To guide.</p>
</div>
<div class="section" id="add-enhanced-runtime-type-checking-to-a-hydra-app">
<h1>Add Enhanced Runtime Type-Checking to a Hydra App<a class="headerlink" href="#add-enhanced-runtime-type-checking-to-a-hydra-app" title="Permalink to this headline">¬∂</a></h1>
<p>Many Python libraries (e.g. NumPy, PyTorch) include so-called <a class="reference external" href="https://www.pythonlikeyoumeanit.com/Module5_OddsAndEnds/Writing_Good_Code.html#Type-Hinting">type hints</a> in the signatures of their
functions and classes; a type-hint documents the type of values that an input
parameter expects. Let‚Äôs turn these hints into promises! We can modify the configs in
our Hydra app so that its configured values are verified against these types at runtime.</p>
<p>In this How-To guide we will:</p>
<ol class="arabic simple">
<li><p>Install a lightweight runtime type-checker, <a class="reference external" href="https://github.com/beartype/beartype">beartype</a>.</p></li>
<li><p>Create ‚Äútoy‚Äù library code that includes type annotations.</p></li>
<li><p>Design configs for a Hydra app that will leverage beartype‚Äôs type-checking throughout its interface.</p></li>
<li><p>Test that bad input values get ‚Äúcaught‚Äù by our type-checker.</p></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>hydra-zen also provides support for the popular runtime type-checker <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a>. It can be used instead of beartype.
Consult the reference for <a class="reference internal" href="../generated/hydra_zen.third_party.pydantic.validates_with_pydantic.html#hydra_zen.third_party.pydantic.validates_with_pydantic" title="hydra_zen.third_party.pydantic.validates_with_pydantic"><code class="xref py py-func docutils literal notranslate"><span class="pre">validates_with_pydantic()</span></code></a> to adapt this How-To accordingly.</p>
</div>
<p>To begin, we will install beartype in our Python environment.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">1: Installing beartype.</span><a class="headerlink" href="#id2" title="Permalink to this code">¬∂</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install beartype
</pre></div>
</div>
</div>
<p>Next, let‚Äôs create a toy example of some library code that uses type hints, but does
not leverage runtime checking of it types. Create a script called <code class="docutils literal notranslate"><span class="pre">toy_library.py</span></code>,
containing the following code.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">2: Creating toy example of library code. Contents of <code class="docutils literal notranslate"><span class="pre">toy_library.py</span></code>.</span><a class="headerlink" href="#id3" title="Permalink to this code">¬∂</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="kn">from</span> <span class="nn">beartype.vale</span> <span class="kn">import</span> <span class="n">Is</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>


<span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Is</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]]</span>


<span class="k">def</span> <span class="nf">process_age</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="n">PositiveInt</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">age</span>


<span class="k">def</span> <span class="nf">process_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
    <span class="k">return</span> <span class="n">shape</span>
</pre></div>
</div>
</div>
<p>Note that the annotation</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Annotation of <code class="docutils literal notranslate"><span class="pre">age</span></code></span><a class="headerlink" href="#id4" title="Permalink to this code">¬∂</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Is</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>indicates that an associated value should not only be an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, but also have a
non-negative value. Whereas</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Annotation of <code class="docutils literal notranslate"><span class="pre">shape</span></code></span><a class="headerlink" href="#id5" title="Permalink to this code">¬∂</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>indicates that a value should either be an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> or any sequence (list, tuple,
etc.) of ints.</p>
<p>Supposing that our Hydra app will configure these two ‚Äútoy‚Äù functions, let‚Äôs design
their configs so that beartype will validate their configured values upon
instantiation.</p>
<p>Open a Python console ‚Äì or Jupyter notebook ‚Äì in the same directory as <code class="docutils literal notranslate"><span class="pre">toy_library.py</span></code> and create the following configs.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">3: Creating configs that include beartype validation.</span><a class="headerlink" href="#id6" title="Permalink to this code">¬∂</a></div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">toy_library</span> <span class="kn">import</span> <span class="n">process_age</span><span class="p">,</span> <span class="n">process_shape</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydra_zen</span> <span class="kn">import</span> <span class="n">make_custom_builds_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydra_zen.third_party.beartype</span> <span class="kn">import</span> <span class="n">validates_with_beartype</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">builds</span> <span class="o">=</span> <span class="n">make_custom_builds_fn</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">populate_full_signature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">zen_wrappers</span><span class="o">=</span><span class="n">validates_with_beartype</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">hydra_convert</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ConfAge</span> <span class="o">=</span> <span class="n">builds</span><span class="p">(</span><span class="n">process_age</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ConfShape</span> <span class="o">=</span> <span class="n">builds</span><span class="p">(</span><span class="n">process_shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, let‚Äôs check that our configured values are validated as-expected.
In the same console, verify that you can replicate the following behavior.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">4: Test that the type-checker catches bad configured values.</span><a class="headerlink" href="#id7" title="Permalink to this code">¬∂</a></div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hydra_zen</span> <span class="kn">import</span> <span class="n">instantiate</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">instantiate</span><span class="p">(</span><span class="n">ConfAge</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="go">12</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">instantiate</span><span class="p">(</span><span class="n">ConfAge</span><span class="p">,</span> <span class="n">age</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># Bad: negative int</span>
<span class="go">BeartypeCallHintPepParamException- process_age() parameter age=-100 violates type</span>
<span class="go">hint [...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">instantiate</span><span class="p">(</span><span class="n">ConfAge</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="s2">&quot;twelve&quot;</span><span class="p">)</span>  <span class="c1"># Bad: not an int</span>
<span class="go">BeartypeCallHintPepParamException- process_age() parameter age=&#39;twelve&#39; violates</span>
<span class="go">type hint [...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">instantiate</span><span class="p">(</span><span class="n">ConfShape</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="go">3</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">instantiate</span><span class="p">(</span><span class="n">ConfShape</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>  <span class="c1"># OK</span>
<span class="go">[1, 2, 5]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">instantiate</span><span class="p">(</span><span class="n">ConfShape</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">])</span>  <span class="c1"># Bad: not a sequence of ints</span>
<span class="go">BeartypeCallHintPepParamException- process_shape() parameter shape=[&#39;a&#39;, &#39;b&#39;]</span>
<span class="go">violates type hint [...]</span>
</pre></div>
</div>
</div>
<p>Awesome! Now mis-configured values will have a bear of a time getting past our app‚Äôs
type-checked interface üêª.</p>
<div class="admonition-references admonition">
<p class="admonition-title">References</p>
<ul class="simple">
<li><p><a class="reference internal" href="../generated/hydra_zen.third_party.beartype.validates_with_beartype.html#hydra_zen.third_party.beartype.validates_with_beartype" title="hydra_zen.third_party.beartype.validates_with_beartype"><code class="xref py py-func docutils literal notranslate"><span class="pre">validates_with_beartype()</span></code></a></p></li>
<li><p><a class="reference internal" href="../explanation/type_refinement.html#type-support"><span class="std std-ref">hydra-zen‚Äôs Automatic Type Refinement Behavior</span></a></p></li>
</ul>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="partial_config.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Partially Configure an Object</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pytorch_lightning.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Run Boilerplate-Free ML Experiments with PyTorch Lightning &amp; hydra-zen</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021 Massachusetts Institute of Technology.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>